# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitLab CI/CD –¥–ª—è FixFix Bot

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **GitLab –∞–∫–∫–∞—É–Ω—Ç** (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω –≤–∫–ª—é—á–∞–µ—Ç 400 –º–∏–Ω—É—Ç CI/CD –≤ –º–µ—Å—è—Ü)
2. **–î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É** –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
3. **SSH –∫–ª—é—á–∏** –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ GitLab

1. –í–æ–π–¥–∏—Ç–µ –≤ GitLab
2. –ù–∞–∂–º–∏—Ç–µ "New Project"
3. –í—ã–±–µ—Ä–∏—Ç–µ "Create blank project"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
   - **Project name**: `fx-bot`
   - **Visibility Level**: `Private` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
   - **Initialize repository with**: –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings > CI/CD > Variables** –∏ –¥–æ–±–∞–≤—å—Ç–µ:

#### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```
DB_PASSWORD          - –ü–∞—Ä–æ–ª—å –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
TELEGRAM_TOKEN      - –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
REQUESTS_GROUP_ID   - ID –≥—Ä—É–ø–ø—ã –¥–ª—è –∑–∞—è–≤–æ–∫
ADMIN_IDS           - ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
SECRET_KEY          - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

#### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**
```
DEPLOY_HOST         - IP –∏–ª–∏ –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞
DEPLOY_USER         - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–æ–±—ã—á–Ω–æ root)
DEPLOY_KEY          - –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–µ–π

#### **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
```bash
# –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
sudo adduser deploy
sudo usermod -aG sudo deploy

# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è deploy
su - deploy

# –°–æ–∑–¥–∞–µ–º SSH –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
mkdir -p ~/.ssh
chmod 700 ~/.ssh

# –°–æ–∑–¥–∞–µ–º authorized_keys
touch ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

#### **–ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:**
```bash
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º SSH –∫–ª—é—á (–µ—Å–ª–∏ –Ω–µ—Ç)
ssh-keygen -t rsa -b 4096 -C "your-email@example.com"

# –ö–æ–ø–∏—Ä—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id deploy@YOUR_SERVER_IP

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh deploy@YOUR_SERVER_IP
```

### 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh deploy@YOUR_SERVER_IP

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker deploy

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
sudo mkdir -p /opt/fixfix-bot
sudo chown deploy:deploy /opt/fixfix-bot
cd /opt/fixfix-bot

# –í—ã—Ö–æ–¥–∏–º –∏–∑ SSH —Å–µ—Å—Å–∏–∏
exit
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ GitLab Runner

#### **–í–∞–∂–Ω–æ**: –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π GitLab Runner –≤–º–µ—Å—Ç–æ –æ–±—â–∏—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π GitLab –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è.

#### **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**

```bash
# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh deploy@YOUR_SERVER_IP

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º GitLab Runner
curl -L "https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh" | sudo bash
sudo apt-get install gitlab-runner

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º runner
sudo gitlab-runner register

# –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–≤–µ–¥–∏—Ç–µ:
# GitLab instance URL: https://gitlab.com (–∏–ª–∏ –≤–∞—à GitLab)
# Registration token: (–ø–æ–ª—É—á–∏—Ç–µ –∏–∑ Settings > CI/CD > Runners)
# Description: fixfix-bot-runner
# Tags: docker,linux
# Executor: docker
# Default image: alpine:latest
# Docker image: alpine:latest

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å runner'–∞
sudo gitlab-runner status

# –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ runner –∞–∫—Ç–∏–≤–µ–Ω –≤ GitLab
# Settings > CI/CD > Runners –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π runner
```

#### **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker executor:**

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é runner'–∞
sudo nano /etc/gitlab-runner/config.toml

# –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ–∫—Ü–∏—é [runners.docker]:
# privileged = true
# volumes = ["/var/run/docker.sock:/var/run/docker.sock", "/cache"]

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º runner
sudo gitlab-runner restart
```

### 6. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh deploy@YOUR_SERVER_IP
cd /opt/fixfix-bot
git clone https://gitlab.com/YOUR_USERNAME/fixfix-bot.git .
```

### 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ GitLab

–í GitLab –ø—Ä–æ–µ–∫—Ç–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings > CI/CD > Variables**:

#### **DB_PASSWORD**
- **Key**: `DB_PASSWORD`
- **Value**: `your_secure_database_password`
- **Type**: Variable
- **Protected**: ‚úÖ
- **Masked**: ‚úÖ

#### **TELEGRAM_TOKEN**
- **Key**: `TELEGRAM_TOKEN`
- **Value**: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`
- **Type**: Variable
- **Protected**: ‚úÖ
- **Masked**: ‚úÖ

#### **DEPLOY_KEY**
- **Key**: `DEPLOY_KEY`
- **Value**: –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∞—à–µ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ SSH –∫–ª—é—á–∞
- **Type**: Variable
- **Protected**: ‚úÖ
- **Masked**: ‚ùå

#### **DEPLOY_HOST**
- **Key**: `DEPLOY_HOST`
- **Value**: `YOUR_SERVER_IP`
- **Type**: Variable
- **Protected**: ‚úÖ
- **Masked**: ‚ùå

### 8. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ CI/CD

1. **–ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏ –∑–∞–ø—É—à—å—Ç–µ** –≤—Å–µ —Ñ–∞–π–ª—ã –≤ GitLab
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **CI/CD > Pipelines**
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤ `test` –∏ `build`
4. –í —ç—Ç–∞–ø–µ `deploy` –Ω–∞–∂–º–∏—Ç–µ **Play** –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ CI/CD
- **CI/CD > Pipelines** - –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å
- **CI/CD > Jobs** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- **CI/CD > Schedules** - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** –≤ Settings > CI/CD > Variables
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** –∫ —Å–µ—Ä–≤–µ—Ä—É
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è CI/CD

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- GitLab –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫—ç—à–∏—Ä—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
- Docker —Å–ª–æ–∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É —Å–±–æ—Ä–∫–∞–º–∏

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –≠—Ç–∞–ø—ã `test` –∏ `build` –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ CI/CD

### –£—Å–ª–æ–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- `deploy` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º `build`
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Protected branches** –¥–ª—è main –≤–µ—Ç–∫–∏
2. **–í–∫–ª—é—á–∏—Ç–µ Protected variables** –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ –ø—Ä–æ–µ–∫—Ç—É
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** SSH –∫–ª—é—á–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `DB_PASSWORD` - –∑–∞—â–∏—â–µ–Ω–Ω–∞—è –∏ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è
- `TELEGRAM_TOKEN` - –∑–∞—â–∏—â–µ–Ω–Ω–∞—è –∏ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è
- `DEPLOY_KEY` - –∑–∞—â–∏—â–µ–Ω–Ω–∞—è (–Ω–æ –Ω–µ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
- `SECRET_KEY` - –∑–∞—â–∏—â–µ–Ω–Ω–∞—è –∏ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

### GitLab CI/CD –ª–∏–º–∏—Ç—ã
- **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω**: 400 –º–∏–Ω—É—Ç/–º–µ—Å—è—Ü
- **–≠—Ç–∞–ø test**: ~2-3 –º–∏–Ω—É—Ç—ã
- **–≠—Ç–∞–ø build**: ~5-10 –º–∏–Ω—É—Ç
- **–≠—Ç–∞–ø deploy**: ~2-3 –º–∏–Ω—É—Ç—ã

### –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ Dockerfile
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### Webhook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
1. –í GitLab: **Settings > Webhooks**
2. URL: `https://YOUR_SERVER/webhook`
3. Triggers: **Push events**
4. SSL verification: ‚úÖ

### Cron –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
–í GitLab: **CI/CD > Schedules**
- **Description**: Daily Update
- **Interval Pattern**: `0 2 * * *` (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00)
- **Target Branch**: `main`
- **Variables**: –ø—É—Å—Ç–æ

---

**–£–¥–∞—á–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π GitLab CI/CD! üöÄ**
