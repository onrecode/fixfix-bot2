#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏
"""
import asyncio
import json
from datetime import datetime

# –°–∏–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
test_user_id = 12345
test_username = "test_user"

# –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
test_scenarios = [
    {
        "name": "–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ö–æ–º–ø—å—é—Ç–µ—Ä –≥–ª—é—á–∏—Ç ‚Üí –¢–æ—Ä–º–æ–∑–∏—Ç ‚Üí –û–ø–∏—Å–∞–Ω–∏–µ ‚Üí –£–¥–∞–ª–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å ‚Üí –¢–µ–ª–µ—Ñ–æ–Ω",
        "steps": [
            ("üî¥ –ö–æ–º–ø—å—é—Ç–µ—Ä –≥–ª—é—á–∏—Ç/–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç", "category"),
            ("üíª –¢–æ—Ä–º–æ–∑–∏—Ç/–ù–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è", "service"),
            ("–ö–æ–º–ø—å—é—Ç–µ—Ä –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º", "description"),
            ("üíª –£–¥–∞–ª–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å", "work_format"),
            ("+7 999 123-45-67", "phone")
        ],
        "expected_result": {
            "category": "üî¥ –ö–æ–º–ø—å—é—Ç–µ—Ä –≥–ª—é—á–∏—Ç/–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç",
            "service": "üíª –¢–æ—Ä–º–æ–∑–∏—Ç/–ù–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è",
            "description": "–ö–æ–º–ø—å—é—Ç–µ—Ä –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º",
            "work_format": "üíª –£–¥–∞–ª–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å",
            "address": None,
            "preferred_time": "‚è∞ –õ—é–±–æ–µ –≤—Ä–µ–º—è",
            "phone": "+7 999 123-45-67"
        }
    },
    {
        "name": "–°—Ü–µ–Ω–∞—Ä–∏–π 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É ‚Üí –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É ‚Üí –û–ø–∏—Å–∞–Ω–∏–µ ‚Üí –í—ã–µ–∑–¥ –Ω–∞ –¥–æ–º ‚Üí –ê–¥—Ä–µ—Å ‚Üí –í—Ä–µ–º—è ‚Üí –¢–µ–ª–µ—Ñ–æ–Ω",
        "steps": [
            ("‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É", "category"),
            ("üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É", "service"),
            ("–ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Photoshop –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥—Ä–∞—Ñ–∏–∫–æ–π", "description"),
            ("üè† –í—ã–µ–∑–¥ –Ω–∞ –¥–æ–º", "work_format"),
            ("—É–ª. –õ–µ–Ω–∏–Ω–∞ 15, –∫–≤ 5, –ø–æ—Å–ª–µ 18:00", "address"),
            ("üåÜ –í–µ—á–µ—Ä (18:00-22:00)", "preferred_time"),
            ("+7 999 123-45-67", "phone")
        ],
        "expected_result": {
            "category": "‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É",
            "service": "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É",
            "description": "–ù—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Photoshop –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥—Ä–∞—Ñ–∏–∫–æ–π",
            "work_format": "üè† –í—ã–µ–∑–¥ –Ω–∞ –¥–æ–º",
            "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞ 15, –∫–≤ 5, –ø–æ—Å–ª–µ 18:00",
            "preferred_time": "üåÜ –í–µ—á–µ—Ä (18:00-22:00)",
            "phone": "+7 999 123-45-67"
        }
    },
    {
        "name": "–°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Üí –û–ø–∏—Å–∞–Ω–∏–µ ‚Üí –í—ã–µ–∑–¥ –Ω–∞ –¥–æ–º ‚Üí –ê–¥—Ä–µ—Å ‚Üí –í—Ä–µ–º—è ‚Üí –¢–µ–ª–µ—Ñ–æ–Ω",
        "steps": [
            ("‚úçÔ∏è –û–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏", "category"),
            ("–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –¥–æ–º–∞—à–Ω–µ–π —Å–µ—Ç–∏", "description"),
            ("üè† –í—ã–µ–∑–¥ –Ω–∞ –¥–æ–º", "work_format"),
            ("–ø—Ä. –ú–∏—Ä–∞ 188–± –∫–æ—Ä–ø2, –∫–≤ 5", "address"),
            ("‚òÄÔ∏è –î–µ–Ω—å (12:00-18:00)", "preferred_time"),
            ("+7 999 123-45-67", "phone")
        ],
        "expected_result": {
            "category": "‚úçÔ∏è –û–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏",
            "service": "‚úçÔ∏è –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç",
            "description": "–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –¥–æ–º–∞—à–Ω–µ–π —Å–µ—Ç–∏",
            "work_format": "üè† –í—ã–µ–∑–¥ –Ω–∞ –¥–æ–º",
            "address": "–ø—Ä. –ú–∏—Ä–∞ 188–± –∫–æ—Ä–ø2, –∫–≤ 5",
            "preferred_time": "‚òÄÔ∏è –î–µ–Ω—å (12:00-18:00)",
            "phone": "+7 999 123-45-67"
        }
    },
    {
        "name": "–°—Ü–µ–Ω–∞—Ä–∏–π 4: –ê–ø–≥—Ä–µ–π–¥ ‚Üí –°–æ–±—Ä–∞—Ç—å –ü–ö —Å –Ω—É–ª—è ‚Üí –ò–≥—Ä–æ–≤–æ–π –ü–ö ‚Üí –û–ø–∏—Å–∞–Ω–∏–µ ‚Üí –ó–∞–±—Ä–∞—Ç—å —Ç–µ—Ö–Ω–∏–∫—É ‚Üí –ê–¥—Ä–µ—Å ‚Üí –í—Ä–µ–º—è ‚Üí –¢–µ–ª–µ—Ñ–æ–Ω",
        "steps": [
            ("üöÄ –•–æ—á—É –∞–ø–≥—Ä–µ–π–¥", "category"),
            ("üîß –°–æ–±—Ä–∞—Ç—å –ü–ö —Å –Ω—É–ª—è", "service"),
            ("üéÆ –ò–≥—Ä–æ–≤–æ–π –ü–ö", "pc_build"),
            ("–ù—É–∂–µ–Ω –º–æ—â–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–≥—Ä", "description"),
            ("üöö –ó–∞–±—Ä–∞—Ç—å —Ç–µ—Ö–Ω–∏–∫—É", "work_format"),
            ("—É–ª. –ü—É—à–∫–∏–Ω–∞ 10, –∫–≤ 15", "address"),
            ("üåÖ –£—Ç—Ä–æ (9:00-12:00)", "preferred_time"),
            ("+7 999 123-45-67", "phone")
        ],
        "expected_result": {
            "category": "üöÄ –•–æ—á—É –∞–ø–≥—Ä–µ–π–¥",
            "service": "üîß –°–æ–±—Ä–∞—Ç—å –ü–ö —Å –Ω—É–ª—è",
            "description": "–ù—É–∂–µ–Ω –º–æ—â–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–≥—Ä",
            "work_format": "üöö –ó–∞–±—Ä–∞—Ç—å —Ç–µ—Ö–Ω–∏–∫—É",
            "address": "—É–ª. –ü—É—à–∫–∏–Ω–∞ 10, –∫–≤ 15",
            "preferred_time": "üåÖ –£—Ç—Ä–æ (9:00-12:00)",
            "phone": "+7 999 123-45-67"
        }
    },
    {
        "name": "–°—Ü–µ–Ω–∞—Ä–∏–π 5: Wi-Fi ‚Üí –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Wi-Fi —Ä–æ—É—Ç–µ—Ä ‚Üí –û–ø–∏—Å–∞–Ω–∏–µ ‚Üí –í –æ—Ñ–∏—Å ‚Üí –¢–µ–ª–µ—Ñ–æ–Ω",
        "steps": [
            ("üåê ¬´–°–ª–∞–±—ã–π Wi-Fi / –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä¬ª", "category"),
            ("üì∂ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Wi-Fi —Ä–æ—É—Ç–µ—Ä", "service"),
            ("–ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä TP-Link –¥–ª—è –æ—Ñ–∏—Å–∞", "description"),
            ("üè¢ –í –æ—Ñ–∏—Å", "work_format"),
            ("+7 999 123-45-67", "phone")
        ],
        "expected_result": {
            "category": "üåê ¬´–°–ª–∞–±—ã–π Wi-Fi / –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä¬ª",
            "service": "üì∂ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Wi-Fi —Ä–æ—É—Ç–µ—Ä",
            "description": "–ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä TP-Link –¥–ª—è –æ—Ñ–∏—Å–∞",
            "work_format": "üè¢ –í –æ—Ñ–∏—Å",
            "address": None,
            "preferred_time": "‚è∞ –õ—é–±–æ–µ –≤—Ä–µ–º—è",
            "phone": "+7 999 123-45-67"
        }
    }
]

def simulate_request_creation(scenario):
    """–°–∏–º—É–ª—è—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—é"""
    print(f"\nüß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: {scenario['name']}")
    print("=" * 80)
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—è–≤–∫–∏
    request = {
        "request_id": f"FX-{datetime.now().strftime('%Y%m%d')}-001",
        "user_id": test_user_id,
        "username": test_username,
        "status": "–Ω–æ–≤–∞—è",
        "created_at": datetime.now().isoformat()
    }
    
    # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —à–∞–≥–æ–≤
    for i, (input_text, step_type) in enumerate(scenario['steps'], 1):
        print(f"–®–∞–≥ {i}: {step_type} ‚Üí '{input_text}'")
        
        if step_type == "category":
            request["category"] = input_text
        elif step_type == "service":
            request["service"] = input_text
        elif step_type == "pc_build":
            # –î–ª—è —Å–±–æ—Ä–∫–∏ –ü–ö –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–∏–µ
            request["description"] = input_text
        elif step_type == "description":
            request["description"] = input_text
        elif step_type == "work_format":
            request["work_format"] = input_text
            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º preferred_time –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ –±–µ–∑ –≤—ã–µ–∑–¥–∞
            if "üè† –í—ã–µ–∑–¥ –Ω–∞ –¥–æ–º" not in input_text and "üöö –ó–∞–±—Ä–∞—Ç—å —Ç–µ—Ö–Ω–∏–∫—É" not in input_text:
                request["preferred_time"] = "‚è∞ –õ—é–±–æ–µ –≤—Ä–µ–º—è"
                print(f"  ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ: preferred_time = '‚è∞ –õ—é–±–æ–µ –≤—Ä–µ–º—è'")
        elif step_type == "address":
            request["address"] = input_text
        elif step_type == "preferred_time":
            request["preferred_time"] = input_text
        elif step_type == "phone":
            request["phone"] = input_text
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è
    if "‚úçÔ∏è –û–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏" in request.get("category", ""):
        if "service" not in request:
            request["service"] = "‚úçÔ∏è –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç"
            print(f"  ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ: service = '‚úçÔ∏è –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç'")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    print(f"\nüìã –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏:")
    print(f"üÜî ID: {request['request_id']}")
    print(f"üìù –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {request.get('category', '–ù–µ—Ç')}")
    print(f"üîß –£—Å–ª—É–≥–∞: {request.get('service', '–ù–µ—Ç')}")
    print(f"üìÑ –û–ø–∏—Å–∞–Ω–∏–µ: {request.get('description', '–ù–µ—Ç')}")
    print(f"üìç –§–æ—Ä–º–∞—Ç: {request.get('work_format', '–ù–µ—Ç')}")
    print(f"üè† –ê–¥—Ä–µ—Å: {request.get('address', '–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è')}")
    print(f"‚è∞ –í—Ä–µ–º—è: {request.get('preferred_time', '–ù–µ —É–∫–∞–∑–∞–Ω–æ')}")
    print(f"üìû –¢–µ–ª–µ—Ñ–æ–Ω: {request.get('phone', '–ù–µ—Ç')}")
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è
    validation_errors = []
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
    required_fields = ['category', 'work_format', 'preferred_time', 'phone']
    for field in required_fields:
        if field not in request or not request[field]:
            validation_errors.append(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ: {field}")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è
    if 'description' not in request or len(request.get('description', '').strip()) < 10:
        validation_errors.append("–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –æ–∂–∏–¥–∞–µ–º–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
    for key, expected_value in scenario['expected_result'].items():
        if key in request:
            actual_value = request[key]
            if actual_value != expected_value:
                validation_errors.append(f"–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –ø–æ–ª–µ '{key}': –æ–∂–∏–¥–∞–ª–æ—Å—å '{expected_value}', –ø–æ–ª—É—á–µ–Ω–æ '{actual_value}'")
    
    if validation_errors:
        print(f"\n‚ùå –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:")
        for error in validation_errors:
            print(f"  ‚Ä¢ {error}")
        return False
    else:
        print(f"\n‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
        return True

def test_all_scenarios():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤"""
    print("üöÄ –ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏")
    print("=" * 80)
    
    successful_scenarios = 0
    total_scenarios = len(test_scenarios)
    
    for scenario in test_scenarios:
        try:
            if simulate_request_creation(scenario):
                successful_scenarios += 1
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è: {e}")
    
    print(f"\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:")
    print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ: {successful_scenarios}")
    print(f"‚ùå –û—à–∏–±–æ–∫: {total_scenarios - successful_scenarios}")
    print(f"üìà –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: {(successful_scenarios / total_scenarios) * 100:.1f}%")
    
    if successful_scenarios == total_scenarios:
        print("\nüéâ –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ! –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.")
    else:
        print(f"\n‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã –≤ {total_scenarios - successful_scenarios} —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.")

if __name__ == "__main__":
    test_all_scenarios()
